FROM maven:3-jdk-8

ENV HOME=/graphhopper
RUN mkdir -p $HOME

# install node - only required for JS UI
RUN apt-get install -y wget \
       && curl -sL https://deb.nodesource.com/setup_11.x | bash - \
       && apt-get install -y nodejs

WORKDIR /graphhopper

#Copie code
ADD . $HOME

# cache dependencies
RUN mvn verify clean --fail-never

# create main.js - only required for JS UI
RUN cd web && npm install && npm run bundleProduction && cd ..

# build with source
RUN mvn install -DskipTests

ENTRYPOINT ["sh", "./entrypoint.sh" ]

