FROM maven:3-jdk-8

ENV HOME=/graphhopper
RUN mkdir -p $HOME

# install node - only required for JS UI
RUN apt-get install -y wget \
       && curl -sL https://deb.nodesource.com/setup_11.x | bash - \
       && apt-get install -y nodejs

WORKDIR /graphhopper

# cache dependencies
ADD pom.xml $HOME
RUN mvn verify clean --fail-never

# build with source
ADD . $HOME
RUN mvn install -DskipTests

# create main.js - only required for JS UI
RUN cd web && npm install && npm run bundleProduction && cd ..

ENTRYPOINT ["sh", "./entrypoint.sh" ]

